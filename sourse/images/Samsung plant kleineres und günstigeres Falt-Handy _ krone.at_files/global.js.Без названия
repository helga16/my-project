if(typeof String.prototype.endsWith!=="function"){String.prototype.endsWith=function(suffix){return this.indexOf(suffix,this.length-suffix.length)!==-1}}if(typeof String.prototype.startsWith!=="function"){String.prototype.startsWith=function(searchString,position){position=position||0;return this.indexOf(searchString,position)===position}}function kmmInitMoment(){moment.locale("de-at")}function kmmRegisterHandlebarHelper(){Handlebars.registerHelper("fullDateTime",function(timestamp){moment.locale("de");return moment.unix(timestamp).format("LLLL")})}function kmmAlert(type,title,text){swal({type:type,title:title,text:text,timer:3e3,cancelButtonText:"Abbrechen",allowEscapeKey:false,allowEnterKey:false})}function kmmInitFancyBox(){$("[data-kmm-fancybox]").each(function(i,e){if(!$(e).attr("data-src")){return true}$(e).attr("href",$(e).attr("data-src"));$(e).attr("data-fancybox",$(e).attr("data-kmm-fancybox"));$(e).removeAttr("data-kmm-fancybox")})}function kmmRegioChangeRegionsBox(regio){regio=regio.toLowerCase();regio=regio.replace(/\u00f6/gi,"ö");regio=regio.replace(/\u00e4/gi,"ä");var strmap=new Array;strmap["wien"]="wien";strmap["niederösterreich"]="noe";strmap["burgenland"]="bgld";strmap["oberösterreich"]="ooe";strmap["kärnten"]="knt";strmap["steiermark"]="stmk";strmap["salzburg"]="sbg";strmap["tirol"]="tirol";strmap["vorarlberg"]="vbg";var sel=".box.c_regions select.selectautosize__select";var opt='option[value="'+strmap[regio]+'"]';if($(sel+" "+opt).length>0){$(sel).val(strmap[regio]).change();return true}else{return false}}function kmmRegioFragmentsHide(region){$("[class*='async_frag_']").hide();$(".async_frag_"+region).show()}function kmmRegioLoad(region){KRNGTMPush("regio_selected",{region:region.toLowerCase()});$("[class*='async_frag_'] .c_anmod").remove();region=region.toLowerCase();region=kmmRegioReplace(region);if(window.krn_async_fragments){switch(region){case"niederoesterreich":var region_loader="ost";break;case"burgenland":var region_loader="ost";break;case"tirol":var region_loader="west";break;case"vorarlberg":var region_loader="west";break;default:var region_loader=region}var funcStr="krn_loader_regio_"+region_loader;if(typeof window[funcStr]==="function"){kmmRegioFragmentsHide(region_loader);eval(funcStr+"()");kmmRegioFilterFragDuplicates(region_loader)}if($("body").attr("class")&&$("body").attr("class").search("regio-")>=0){var classes=$("body").attr("class").split(/\s+/);$.each(classes,function(i,v){if(v.search("regio-")<0){return true}$("body").removeClass(v);$("body").addClass("regio-"+region)})}else{$("body").addClass("regio-"+region)}}}function kmmRegioTopBarSwitch(assign){var selector=".c_top-bar";var fadeTime=200;if(assign){$(selector+" .tb__regio--not-assigned").hide();$(selector+" .tb__regio--assigned").fadeIn(fadeTime)}else{$(selector+" .tb__regio--assigned").hide();$(selector+" .tb__regio--not-assigned").fadeIn(fadeTime)}$(selector+" .c_top-bar-link").fadeIn(fadeTime)}function kmmRegioChangeTopBarRegion(region){var selector="#kmm-regio-top-bar-region";region=region.charAt(0).toUpperCase()+region.substr(1);$(selector+" .text").html(region);region=kmmRegioReplace(region);$(selector+" .icon").attr("class","icon "+region.toLowerCase())}function showRegioLabelForDivs(divs,rid,map){divs.each(function(){if($(this).parent().hasClass("krn_regio_label")){$(this).find("a").append('<div class="rkz">'+map[rid]+"</div>");$(this).attr("data-krn-rid",rid);$(this).addClass("regionalized")}})}function kmmRegioFilterFragDuplicates(region){var aufmacher_ids=[];$(".krn-regio-dup-checker").each(function(){var anmods=$(this).find("[data-krn-type]");anmods.each(function(){var anmod_id=$(this).data("krn-id");aufmacher_ids.push(anmod_id)})});var display_anmods=[];var display_anmod_cnt=2;if(kmmIsMobile()&&region=="default"){display_anmod_cnt=1}var fragClass=".async_frag_"+region;var retry_ms=300;var max_cnt=20;var cur_cnt=0;var checkFragContent=setInterval(function(){var fragAnmods=$(fragClass+" [data-krn-type]");if(cur_cnt==max_cnt){clearInterval(checkFragContent)}cur_cnt++;if(fragAnmods.length){clearInterval(checkFragContent);$(fragAnmods).each(function(){var anmod_id=$(this).data("krn-id");if(aufmacher_ids.indexOf(anmod_id)>-1){return true}display_anmods.push(anmod_id);if(display_anmods.length==display_anmod_cnt){return false}});if(display_anmods.length==display_anmod_cnt){$(display_anmods).each(function(idx){var articleId=this;if(region!="default"){var map=new Array;map[714]="Wien";map[725]="Nieder&ouml;sterreich";map[739]="Burgenland";map[735]="Ober&ouml;sterreich";map[733]="Salzburg";map[729]="Tirol";map[731]="Vorarlberg";map[737]="K&auml;rnten";map[727]="Steiermark";var rids=$('[data-krn-id="'+articleId+'"]').data("krn-rid");$(rids).each(function(){var final_rid=false;var div_holder=$('[data-krn-id="'+articleId+'"]');if(div_holder.parent().hasClass("krn_force_regio")){var classes=div_holder.parent().attr("class").split(" ");classes.forEach(function(e){if(e.match("krn_force_regio_")){final_rid=e.split("_")[3]}})}if(final_rid){showRegioLabelForDivs(div_holder,final_rid,map);return false}if(final_rid==false&&this in map){showRegioLabelForDivs(div_holder,this,map);return false}})}if(kmmIsMobile()&&idx==0){var overlay=$('[data-krn-id="'+articleId+'"]').parent().parent().find(".c_regio-anmod-overlay");overlay.find(".overlay").removeClass("hidden");$('[data-krn-id="'+articleId+'"]').parent().append(overlay.removeClass("box col-xs-12"))}$('[data-krn-id="'+articleId+'"]').parent().removeClass("async_regio_hidden");kmmRegioAnmodsLoaded()})}}},retry_ms)}function kmmRegioAnmodsLoaded(){KRNGIFv.start()}function kmmRegioModal(show){var modalSel="#kmm-regio-select-box";if(show){$(modalSel).modal("show")}else{$(modalSel).modal("hide")}}function kmmRegioSelect(selId){var regioSel=$("#"+selId).val();if(regioSel==null){return false}kmmRegioModal(0);kmmRegioLoad(regioSel);kmmRegioChangeRegionsBox(regioSel);kmmRegioChangeTopBarRegion(regioSel);kmmRegioTopBarSwitch(1);kmmAtlasSendRegio(regioSel);kmmRegioSetBoxElems(regioSel);kmmRegioSwitchNaviLink(regioSel);kmmRegioFooterLink(regioSel);kmmRegioDefaultAnmodsHide();kmmRegioFlapHide(regioSel);if(typeof kmmwetterNaviUpdate=="function"){kmmwetterNaviUpdate(regioSel)}}function kmmRegioSetBoxElems(region){$(".c_regio-navi-select .rns__txt").html("Sie k&ouml;nnen die Auswahl Ihres Bundeslandes jederzeit &auml;ndern:");$("#kmm_regio_select").val(region.toLowerCase())}function kmmAtlasSendRegio(region){ATLAS.setKV("KRN_REGION",region,function(cb){});Cookies.set("KRN_REGION",region,{path:".krone.at"})}function kmmRegioReplace(region){region=region.replace(/\u00f6/gi,"oe");region=region.replace(/\u00e4/gi,"ae");return region}function kmmRegioDefaultAnmodsHide(){$(".async_frag_default").hide()}function KrnGotoRegion(region){kmmRegioLoad(region);kmmRegioChangeRegionsBox(region);kmmRegioChangeTopBarRegion(region);kmmRegioTopBarSwitch(1);kmmRegioSwitchNaviLink(region);kmmRegioSetBoxElems(region);kmmRegioFooterLink(region)}function atlasLoaded(){if(!Cookies.get("KRN_REGION")||Cookies.get("KRN_REGION")=="default"){kmmRegioLoad("default");kmmRegioTopBarSwitch(0);kmmRegioFlap();kmmRegioFooterLink("default");$(".c_regio-select-button").hide()}else{KrnGotoRegion(Cookies.get("KRN_REGION"))}ATLAS.getKV(function(data){if(data.kv){window.ATLAS_KV=data.kv}if(data.kv&&data.kv.KRN_REGION){var region=data.kv.KRN_REGION;KrnGotoRegion(region)}})}function kmmRegioFlap(region){var flapElem=$(".c_regio-select-flap");if(!flapElem.length){return false}var topBarElem=$(".top-bar-regio");var topBarElemToggleClass="active";var cookieNameConsent="krn_consent_shown";var cookieName="kmm_regio_flap_shown";var cookieExpire=2;var timeoutFadeIn=500;var timeoutFadeOut=100;var timeoutHide=1e4;var isV2=flapElem.hasClass("v2");if(Cookies.get(cookieNameConsent)&&!Cookies.get(cookieName)){flapElem.fadeIn(timeoutFadeIn);if(!isV2){topBarElem.addClass(topBarElemToggleClass)}Cookies.set(cookieName,1,{expires:cookieExpire,path:"/"})}var FlapFadeTimeout;FlapFadeTimeout=window.setTimeout(function(){FlapFadeTimeout=null;flapElem.fadeOut(timeoutFadeOut);if(!isV2){topBarElem.removeClass(topBarElemToggleClass)}},timeoutHide);flapElem.mouseleave(function(){FlapFadeTimeout=window.setTimeout(function(){FlapFadeTimeout=null;flapElem.fadeOut(timeoutFadeOut);if(!isV2){topBarElem.removeClass(topBarElemToggleClass)}},timeoutHide)});var FlapFadeTimeout;flapElem.mouseenter(function(){window.clearTimeout(FlapFadeTimeout)})}function kmmRegioFlapHide(){var flapElem=$(".c_regio-select-flap");flapElem.hide();var topBarElem=$(".top-bar-regio");var topBarElemToggleClass="active";topBarElem.removeClass(topBarElemToggleClass)}function kmmRegioSwitchNaviLink(region){region=region.toLowerCase();region=kmmRegioReplace(region);var strmap=new Array;strmap["wien"]="Wien";strmap["niederoesterreich"]="N&Ouml; / Bgld.";strmap["burgenland"]="N&Ouml; / Bgld.";strmap["oberoesterreich"]="Ober&ouml;sterreich";strmap["kaernten"]="K&auml;rnten";strmap["steiermark"]="Steiermark";strmap["salzburg"]="Salzburg";strmap["tirol"]="Tirol / Vlbg.";strmap["vorarlberg"]="Tirol / Vlbg.";var linkmap=new Array;linkmap["wien"]="wien";linkmap["niederoesterreich"]="bundeslaender-ost";linkmap["burgenland"]="bundeslaender-ost";linkmap["oberoesterreich"]="oberoesterreich";linkmap["kaernten"]="kaernten";linkmap["steiermark"]="steiermark";linkmap["salzburg"]="salzburg";linkmap["tirol"]="bundeslaender-west";linkmap["vorarlberg"]="bundeslaender-west";if(typeof strmap[region]!="undefined"){$('.c_navi-navbar .navi-navbar__inner > .c_navi-link > [data-ressort_id="790"] > .navi-link__link').html(strmap[region]).attr("href","/"+linkmap[region]);if(kmmIsMobile()){$('.krn-mdc__navi-list > .krn-mdc__navi-link[data-ressort_id="790"] .mdc-list-item__text').html(strmap[region]).attr("href","/"+linkmap[region]);$('.krn-mdc__navi-list > .krn-mdc__navi-link-group .krn-mdc__navi-link-group-holder .krn-mdc__navi-link[data-ressort_id="790"] .mdc-list-item__text').html(strmap[region]).attr("href","/"+linkmap[region]);$('.krn-mdc__subnavi-list .krn-mdc__subnavi-link[data-ressort_id="790"] .krn-mdc__subnavi-link--text').html(strmap[region]).attr("href","/"+linkmap[region])}}}function kmmRegioFooterLink(region){if(typeof region=="undefined"){if(!window.ATLAS_KV||!window.ATLAS_KV.KRN_REGION){return false}var region=window.ATLAS_KV.KRN_REGION}else{region=region.charAt(0).toUpperCase()+region.substr(1)}region_class=region.replace(/\u00f6/gi,"oe");region_class=region_class.replace(/\u00e4/gi,"ae");$(".mf__link-list--regio .logo").attr("class","logo");$(".mf__link-list--regio .mf__regio-txt").text("");$(".mf__link-list.mf__link-list--regio .logo").addClass(region_class.toLowerCase());if(region.toLowerCase()!="default"){$(".mf__regio-txt").text(region);$(".mf__regio-txt").show();$(".mf__btn-regio").text("Bundesland ändern?")}else{$(".mf__btn-regio").show();$(".mf__btn-regio").text("Bundesland auswählen");$(".mf__regio-txt").hide()}$(".mf__link-list--regio").show()}function registerPlayerInView(playerId){var bmPlayer=bitmovin.player(playerId);var playerVar=playerId.replace(/\-/g,"_");$(document).on("resize scroll",function(){var inViewDisabled=window[playerVar+"_inViewDisabled"];var videoFinished=window[playerVar+"_playbackFinished"];var adFinished=window[playerVar+"_adFinished"];if(inViewDisabled){return false}if(!bmPlayer.isAd()&&!videoFinished){if(!videoFinished&&$("#"+playerId).isInViewport()){if(bmPlayer.isPaused()){bmPlayer.play()}}else{if(bmPlayer.isPlaying()){bmPlayer.pause("inview")}}}})}function kmmReframe(){if(typeof jQuery().reframe=="undefined"||!jQuery().reframe){setTimeout(kmmReframe,100);return false}$(".box.c_content, .box.c_featured-image").find('iframe[src*="vimeo.com"], iframe[src*="youtube.com"], iframe[src*="glomex.com"]').reframe()}jQuery.fn.exists=function(){return this.length>0};jQuery.fn.isInViewport=function(){if(!$(this).length){return false}var elementTop=$(this).offset().top;var elementBottom=elementTop+$(this).outerHeight();var viewportTop=$(window).scrollTop();var viewportBottom=viewportTop+$(window).height();return elementBottom>viewportTop&&elementTop<viewportBottom};function kmmIsMobile(){if($("body").hasClass("is-mobile")){return true}}function kmmIsArticle(){return window.location.pathname.match(/^\/([0-9]+).*$/)}function kmmTrackArticle(){if(window.KRN_CORE_CONFIG.urlIsStable===false){console.log("SKIP PV");return}var krnIsArticle=kmmIsArticle();if(krnIsArticle){var trackingHost=KRN.settings.system+KRN.settings.domains.TRACKING;var Trackts=new Date;$.get("//"+trackingHost+"/key__pv-article-"+krnIsArticle[1]+"/track?ts="+Trackts.getTime(),function(){console.log("PV tracked: "+krnIsArticle[0])})}}function kmmInjectAdminBar(){if(typeof Cookies.get("wp-backend-session")!=="undefined"){var bar="<div style='position: fixed; z-index: 100000; bottom: 100px; right: 150px; height: 0px; width: 0px; background-color: transparent' id='krnbackendbar'></div>";$("body").prepend(bar);$.post("/krn/backend_bar",function(d){$("#krnbackendbar").html(d)});return}$(".to_desktop").click(function(){Cookies.set("KMM_MOBILE_DISABLED","1",{domain:"krone.at",path:"/"});detectMobile()});$("body").on("click",".todesktop",function(){Cookies.remove("KMM_MOBILE_DISABLED",{domain:"krone.at",path:"/"});window.location.href=window.location.href.replace("www","mobil")})}function kmmGetParameterByName(name,url){if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);if(!results)return null;if(!results[2])return"";return decodeURIComponent(results[2].replace(/\+/g," "))}function kmmLoadScriptAsync(url,cb){var head=document.getElementsByTagName("head")[0];var el=document.createElement("script");if(typeof cb!="undefined"&&cb!=null){el.onload=el.onreadystatechange=function(){if(el.readyState&&el.readyState!=="complete"&&el.readyState!=="loaded"){return false}el.onload=el.onreadystatechange=null;cb()}}el.async=true;el.src=url;head.insertBefore(el,head.firstChild)}function kmmRemoveEmptyBoxes(){$(".box:not(.c_gpt-ad)").each(function(i,e){if(!$.trim($(e).html())){$(e).remove()}})}function kmmWilliFormFix(){(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="//www.willi.aka.krone.at/embed";fjs.parentNode.insertBefore(js,fjs)})(document,"script","willi-embed")}function kmmWM2018Slider(config){var $par=$(".js-slick");if(!$par.length){return false}$par.wrapInner('<div class="slickslider"></div>');$par.append('<div class="slickslider__prev"><i class="fa fa-angle-left" aria-hidden="true"></i></div>'+'<div class="slickslider__next"><i class="fa fa-angle-right" aria-hidden="true"></i></div>');var defaults={nextArrow:$par.find(".slickslider__next"),prevArrow:$par.find(".slickslider__prev")};var desktopConfig={slidesToShow:4,slidesToScroll:4};var mobileConfig={slidesToShow:2,slidesToScroll:2};var bundleConfig=kmmIsMobile()?mobileConfig:desktopConfig;var extendedConfig=config||{};$par.find(".slickslider").slick($.extend({},defaults,bundleConfig,extendedConfig))}function kmmBoxHandlebars(templateId,holderId,data){if(typeof data=="undefined"){data={}}var source=$("#"+templateId).html();var template=Handlebars.compile(source);var html=template(data);$("#"+holderId).html(html)}function kmmTabbedBox(selectors){var $selectors=selectors||$(".js-tabbedbox");$selectors.each(function(){var $tabs=$(this).find(".tabbedbox-tab");var $content=$(this).find(".tabbedbox-content");$tabs.first().addClass("active");$content.not(":first").hide();$tabs.on("click",function(){var isIndex=$(this).index();$tabs.removeClass("active").eq(isIndex).addClass("active");$content.hide().eq(isIndex).fadeIn();if($(this).text()=="Gelesen"){$("#numbered-teaser-hours").text("(der letzten 72 Stunden)")}else if($(this).text()=="Kommentiert"){$("#numbered-teaser-hours").text("(der letzten 48 Stunden)")}})})}function krnReadingProgressInit(contentWrapper){if(!kmmIsArticle()){return false}var windowWrapper=contentWrapper;var scrollWrapper=contentWrapper;if(typeof contentWrapper=="undefined"){contentWrapper="body";scrollWrapper=document;windowWrapper=window}$(document).ready(function(){var progressBarHtml='<div class="reader-progress-container">'+'<span class="reader-progress-bar"></span>'+"</div>";if(contentWrapper=="body"){$(contentWrapper).append(progressBarHtml)}else{$(contentWrapper).after(progressBarHtml)}var progressBar=$(".reader-progress-bar");if(!progressBar.exists()){return false}var getContentHeight=function(){var contentHeight=0;$(contentWrapper+" > *:visible").each(function(i,e){var oH=$(e).outerHeight(true);var tN=$(e)[0].tagName;var cL=[];if(typeof $(e).attr("class")!="undefined"){cL=$(e).attr("class").split(/\s+/)}var ignoreList=["SCRIPT","STYLE","VIDEO"];if(!$.isNumeric(oH)||oH<=0||$.inArray(tN,ignoreList)>-1||$.inArray("modal",cL)>-1||$.inArray("sf-toolbar",cL)>-1){return true}contentHeight+=oH});return contentHeight};var getScrollWindowHeight=function(){return $(windowWrapper).outerHeight(true)};var getAvailableContentHeight=function(){return getContentHeight()-getScrollWindowHeight()};var getScrollPosition=function(){return $(windowWrapper).scrollTop()};var availableContentHeight;var scrollPosition;var progressWidth;var getProgressWidth=function(){scrollPosition=getScrollPosition();progressWidth=scrollPosition/availableContentHeight*100;progressWidth=Math.round(progressWidth);progressWidth=progressWidth+"%";return progressWidth};var setProgressWidth=function(){availableContentHeight=getAvailableContentHeight();progressBar.css({width:getProgressWidth()})};$(scrollWrapper)[0].addEventListener("scroll",setProgressWidth,{passive:true});$(window).resize(setProgressWidth)})}$.urlParam=function(name){var results=new RegExp("[?&]"+name+"=([^&#]*)").exec(window.location.href);if(results==null){return null}return decodeURI(results[1])||0};function krnFireCoinEvent(eventName){}function krnGetUserBalance(){}var KRNLoadUserProfilePromise=[];function krnLoadUserProfileData(route,method){method=method==undefined||method==null?"GET":method;if(!KRNLoadUserProfilePromise[route]){KRNLoadUserProfilePromise[route]=new Promise(function(resolve,reject){var apiHost=KRN.settings.system+KRN.settings.domains.API;var apiUrl="//"+apiHost+"/v1/"+route;$.ajax({dataType:"json",url:apiUrl,type:method,xhrFields:{withCredentials:true},success:function(response){resolve(response)},error:function(e){reject()}})})}return KRNLoadUserProfilePromise[route]}function krnProfileActionIfValid(box,callback,forceLogin){forceLogin=forceLogin==true?true:false;$boxes=$(box);jQuery.each($boxes,function(i,elem){if(forceLogin==false&&$(elem).data("user")!=""){callback(elem,$(elem).data("user"))}else{KRNLoginDone().then(function(){if(KRN.user&&(KRN.user.user_id==$(elem).data("user")||$(elem).data("user")==""||$(elem).data("user")==undefined)){callback(elem,KRN.user.user_id)}})}})}function krnProfileActionOnLogout(box,callback){$boxes=$(box);$(document).on("krn-coral-logout",function(){jQuery.each($boxes,function(i,elem){callback(elem)})})}var KRNLoginDonePromise=false;function KRNLoginDone(){if(!KRNLoginDonePromise){KRNLoginDonePromise=new Promise(function(resolve){$(document).on("krn-coral-login",resolve)})}return KRNLoginDonePromise}$(document).on("krn-coral-logout",function(){KRNLoginDonePromise=false});$(document).ready(function(){kmmRemoveEmptyBoxes();KRNGIFv.start();kmmWM2018Slider();kmmTabbedBox();KRNLoginDone()});
if(KRN_CORE_CONFIG.sentry.dsn!=="undefined"){Raven.config(KRN_CORE_CONFIG.sentry.dsn,{release:KRN_CORE_CONFIG.sentry.release,environment:KRN_CORE_CONFIG.sentry.environment,serverName:KRN_CORE_CONFIG.sentry.serverName,sampleRate:.5,ignoreErrors:["AbortError","NotAllowedError"],whitelistUrls:[/krone\.at\//]}).install();console.log("INIT RAVEN!")}
function kmmAuthSetKRNUser(apiData){if(typeof apiData!=="undefined"&&typeof apiData.data!=="undefined"&&typeof apiData.data.user!=="undefined"&&typeof apiData.data.session!=="undefined"&&typeof apiData.data.session.id!=="undefined"){KRN.user=apiData.data.user;KRN.user.session_id=apiData.data.session.id;kmmAuthRenderUserInfo()}else if(typeof KRN!=="undefined"&&typeof KRN.user!=="undefined"&&typeof KRN.user.session_id!=="undefined"){delete KRN.user}}function kmmAuthRenderUserInfo(){if(typeof Cookies.get("KMREGSESSID")==="undefined"||Cookies.get("KMREGSESSID")==="deleted"){$(document).trigger("krn-top-bar-logout");$(".c_comments .c_auth").removeClass("auth-1").addClass("auth-0");$(".c_comments .c_auth .c_user > .c_name").text("");$(".c_comments .c_comment-write textarea").attr("disabled","disabled");$(".c_comments .c_comment-write textarea").attr("placeholder","Um einen Kommentar verfassen zu können, müssen Sie eingeloggt sein.");$(document).trigger("krn-coral-logout");$(document).trigger("krn-mobil-mdl-navi-logout");$(document).trigger("krn-mobil-footer-logout")}else{$(document).trigger("krn-top-bar-login");$(".c_comments .c_auth").removeClass("auth-0").addClass("auth-1");if($(".c_comments .c_auth .c_user > .c_name").text()===""){$(".c_comments .c_auth .c_user > .c_name").text(KRN.user.nickname)}$(".c_comments .c_comment-write textarea").removeAttr("disabled");$(".c_comments .c_comment-write textarea").attr("placeholder","Schreiben Sie einen Kommentar ...");$(document).trigger("krn-coral-login");$(document).trigger("krn-redirect");$(document).trigger("krn-mobil-mdl-navi-login");$(document).trigger("krn-mobil-footer-login")}}$(document).on("krn-redirect",function(){if($.urlParam("targetUrl")){window.location.href=decodeURIComponent($.urlParam("targetUrl"))}});function kmmAuthLoadingButton(formBtn){if(!formBtn){return false}if(typeof formBtn=="string"){formBtn=$("#kmm-auth-box .modal-body .c_"+formBtn+"-form > form button[type=submit]")}if(!formBtn.length){return false}if(formBtn.attr("disabled")&&formBtn.data("inner")&&formBtn.find(".fa-spin").length){formBtn.removeAttr("disabled");formBtn.html(formBtn.data("inner"));formBtn.removeData("inner")}else{formBtn.attr("disabled",true);formBtn.data("inner",formBtn.html());formBtn.html('<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>')}formBtn.blur()}function kmmAuthRenderForm(formArea,formHtml){if(!formArea||formHtml==""){return false}if(typeof formArea=="string"){formArea=$("#kmm-auth-box .modal-body .c_"+formArea+"-form")}if(!formArea.length){return false}formArea.html(formHtml)}function kmmAuthGetFormUrl(formId){if(!formId){return false}var formUrl="//"+KRN.settings.system+KRN.settings.domains.FRONTEND;switch(formId){case"login":formUrl+="/login/form";break;case"login-exist":formUrl+="/login/form/exist";break;case"regist":formUrl+="/registrierung/form";break;case"regist-exist":formUrl+="/registrierung/form/exist";break;case"pw-set":formUrl+="/user/form/pwset";break;case"pw-reset":formUrl+="/user/form/pwreset";break;case"user-settings":formUrl+="/user/form/settings";break}return formUrl}function kmmAuthLoadForm(formId,callback,data,forms){if(!formId){return false}if(!forms){var forms=$("#kmm-auth-box .modal-body .c_"+formId+"-form form")}if(forms.length&&formId!="user-settings"){forms.each(function(i,e){e.reset()});return false}formUrl=kmmAuthGetFormUrl(formId);if(!formUrl){return false}if(!callback){callback=function(){}}if(!data){data={}}$.ajax({type:"POST",url:formUrl,data:data,success:function(formHtml){callback(formHtml)}})}function kmmAuthVerifyForm(formId,callback,data){if(!formId){return false}formUrl=kmmAuthGetFormUrl(formId);if(!formUrl){return false}if(!callback){callback=function(){}}if(!data){data={}}$.ajax({type:"POST",url:formUrl,dataType:"json",data:data,success:function(formData){callback(formData)}})}function kmmAuthAPICall(apiUrl,callback,data){if(!apiUrl){return false}if(!callback){callback=function(){}}if(!data){data={}}var apiUrl="//"+KRN.settings.system+KRN.settings.domains.API+apiUrl;$.ajax({type:"POST",url:apiUrl,dataType:"json",data:data,success:function(apiData){callback(apiData)}})}function kmmAuthBoxReset(){$("#kmm-auth-box .login-regist").addClass("hidden");$("#kmm-auth-box .fb-login-regist").addClass("hidden");$("#kmm-auth-box .pw-reset").addClass("hidden");$("#kmm-auth-box .user-settings").addClass("hidden");$("#kmm-auth-box .kmmauthbox__settingsbtn").removeClass("kmmauthbox__settingsbtn--active");$("#kmm-auth-box .user-settings .kmmauthbox__column").addClass("hidden");$("#kmm-auth-box .pw-set").addClass("hidden");$("#kmm-auth-box button").each(function(i,e){if($(e).attr("disabled")&&$(e).data("inner")&&$(e).find(".fa-spin").length){kmmAuthLoadingButton($(e))}return true});$("#kmm-auth-box .modal-body .c_user-settings-form").html("")}function kmmAuthGetAPIStatusCode(apiData){if(!apiData||!apiData.status||!apiData.status.code){return false}return apiData.status.code}function kmmAuthGetAPIStatusMessage(apiData){if(!apiData||!apiData.status||!apiData.status.msg){return"Interner Systemfehler"}return apiData.status.msg}function kmmNormalizeLoginData(data){cleanData={};$.each(data,function(idx,el){vars=el.name.match(/\[(.*?)\]/g);cName="";$.each(vars,function(idx2,el2){if(cName!=""){cName+="_"}cName+=el2.replace(/\[(.*)\]/,"$1")});cValue=el.value;cleanData[cName]=cValue});return cleanData}function kmmAuthBox(){kmmAuthLogin();kmmAuthRegist();kmmAuthBoxReset();$("#kmm-auth-box .login-regist").removeClass("hidden");$("#kmm-auth-box").modal("show")}function kmmAuthLogin(){kmmAuthLoadForm("login",function(formHtml){kmmAuthRenderForm("login",formHtml);$("#kmm-auth-box .modal-body .c_login-form > form").on("submit",function(){kmmAuthLoadingButton("login");cleanFormData=$(this).serialize();normalizedFormData=kmmNormalizeLoginData($(this).serializeArray());kmmAuthVerifyForm("login",function(formData){kmmAuthAPICall("/authUser",function(apiData){kmmAuthLoadingButton("login");if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);kmmAlert("success",apiData.data.user.nickname,kmmAuthGetAPIStatusMessage(apiData));$("#kmm-auth-box").modal("hide")},normalizedFormData)},cleanFormData);return false})})}function kmmAuthRegist(){kmmAuthLoadForm("regist",function(formHtml){kmmAuthRenderForm("regist",formHtml);kmmRegistActions("regist","#kmm-auth-box .modal-body .c_regist-form > form",true)})}function kmmRegistActions(btn,form,useModal){$(form).on("submit",function(){kmmAuthLoadingButton(btn);cleanFormData=$(this).serialize();normalizedFormData=kmmNormalizeLoginData($(this).serializeArray());if(normalizedFormData.confirm){normalizedFormData.confirm="Y"}kmmAuthVerifyForm("regist",function(formData){kmmAuthAPICall("/createUser",function(apiData){kmmAuthLoadingButton(btn);if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);swal({type:"success",title:"E-Mail bestätigen",text:"Sie erhalten in den nächsten Minuten ein Mail von krone.at mit dem Bestätigungslink. Sollten Sie nicht innerhalb von 24 Stunden auf den Bestätigungslink klicken, so wird der Registrierungsvorgang abgebrochen, Ihre Registrierungsdaten gelöscht und Ihr Benutzername wird zur erneuten Verwendung freigegeben. Bitte vergewissern Sie sich, dass die E-Mail mit dem Bestätigungslink nicht in Ihrem Spam-Ordner gelandet ist.",cancelButtonText:"Bestätigungslink nochmal anfordern",confirmButtonText:"Weiter zu krone.at",confirmButtonColor:"#e2001a",customClass:"kmmAlert",closeOnConfirm:true,closeOnCancel:false,showCancelButton:true,allowEscapeKey:false,allowEnterKey:false},function(isConfirm){if(isConfirm){$(form)[0].reset();return false}var apiPayload={session_id:KRN.user.session_id};kmmAuthAPICall("/requestMailVerify",function(apiData){if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);swal({type:"success",title:"E-Mail bestätigen",text:"Sie erhalten in den nächsten Minuten ein Mail von krone.at mit dem Bestätigungslink. Sollten Sie nicht innerhalb von 24 Stunden auf den Bestätigungslink klicken, so wird der Registrierungsvorgang abgebrochen, Ihre Registrierungsdaten gelöscht und Ihr Benutzername wird zur erneuten Verwendung freigegeben. Bitte vergewissern Sie sich, dass die E-Mail mit dem Bestätigungslink nicht in Ihrem Spam-Ordner gelandet ist.",confirmButtonText:"Weiter zu krone.at",confirmButtonColor:"#e2001a",customClass:"kmmAlert",allowEscapeKey:false,allowEnterKey:false});$(form)[0].reset()},apiPayload)});if(useModal){$("#kmm-auth-box").modal("hide")}},normalizedFormData)},cleanFormData);return false})}function kmmAuthFacebook(buttonElement){if(!krnHasConsens("krn_cons_content")){$("#kmm-auth-box").modal("hide");krnOpenPrivacyPopup();return}kmmAuthLoadingButton($(buttonElement));FB.login(function(FBResponse){if(!FBResponse.authResponse){return false}var apiPayload={facebook_token:FBResponse.authResponse.accessToken};kmmAuthAPICall("/getFacebookUser",function(apiData){if(!kmmAuthGetAPIStatusCode(apiData)){kmmAuthLoadingButton($(buttonElement));kmmAuthLoadForm("regist-exist",function(formHtml){kmmAuthRenderForm("regist-exist",formHtml);$("#kmm-auth-box .modal-body .c_regist-exist-form > form").on("submit",function(){kmmAuthLoadingButton("regist-exist");cleanFormData=$(this).serialize();normalizedFormData=kmmNormalizeLoginData($(this).serializeArray());kmmAuthVerifyForm("regist-exist",function(formData){$("#kmm-auth-box .modal-body .c_regist-exist-form > form").data("formData",normalizedFormData);kmmAuthAPICall("/checkNickname",function(apiData){kmmAuthLoadingButton("regist-exist");var type="error";var title="Ooopps!";if(kmmAuthGetAPIStatusCode(apiData)){kmmAuthSetKRNUser(apiData);type="success";title="Erfolg";if(!$("#kmm-auth-box .modal-body .c_regist-exist-form > form > div #fb_create_user").length){$("#kmm-auth-box .modal-body .c_regist-exist-form > form > div").append('<div class="form-group"><button class="btn kmmauthbox__fbcreatebtn" id="fb_create_user" type="button">Weiter</button></div>')}$("#kmm-auth-box .modal-body .c_regist-exist-form > form #fb_create_user").on("click",function(formData){kmmAuthLoadingButton($("#kmm-auth-box .modal-body .c_regist-exist-form > form #fb_create_user"));FB.getLoginStatus(function(FBResponse,formData){formData=$("#kmm-auth-box .modal-body .c_regist-exist-form > form").data("formData");formData.facebook_token=FBResponse.authResponse.accessToken;kmmAuthAPICall("/createUserByFacebook",function(apiData){kmmAuthLoadingButton($("#kmm-auth-box .modal-body .c_regist-exist-form > form #fb_create_user"));if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);kmmAlert("success",apiData.extended_data.nickname,kmmAuthGetAPIStatusMessage(apiData));$("#kmm-auth-box").modal("hide");var apiPayload={facebook_token:FBResponse.authResponse.accessToken};kmmAuthAPICall("/authUserByFacebook",function(apiData){var type="error";var title="Ooopps!";if(kmmAuthGetAPIStatusCode(apiData)){kmmAuthSetKRNUser(apiData);type="success";title=apiData.data.user.nickname}kmmAlert(type,title,kmmAuthGetAPIStatusMessage(apiData))},apiPayload)},formData)})})}kmmAlert(type,title,kmmAuthGetAPIStatusMessage(apiData))},normalizedFormData)},cleanFormData);return false})});kmmAuthLoadForm("login-exist",function(formHtml){kmmAuthRenderForm("login-exist",formHtml);$("#kmm-auth-box .modal-body .c_login-exist-form > form").on("submit",function(){kmmAuthLoadingButton("login-exist");cleanFormData=$(this).serialize();normalizedFormData=kmmNormalizeLoginData($(this).serializeArray());kmmAuthVerifyForm("login-exist",function(formData){FB.getLoginStatus(function(FBResponse){normalizedFormData.facebook_token=FBResponse.authResponse.accessToken;kmmAuthAPICall("/authUserByFacebook",function(apiData){kmmAuthLoadingButton("login-exist");if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);swal({type:"success",title:"Verknüpfung erfolgreich",text:"Herzlichen Glückwunsch! Ihr krone.at Konto ist nun mit Ihrem Facebook-Profil verknüpft.",confirmButtonText:"Weiter zu krone.at",confirmButtonColor:"#e2001a",customClass:"kmmAlert"});$("#kmm-auth-box").modal("hide")},normalizedFormData)})},cleanFormData);return false})});kmmAuthBoxReset();$("#kmm-auth-box .fb-login-regist").removeClass("hidden");return false}kmmAuthSetKRNUser(apiData);var apiPayload={facebook_token:FBResponse.authResponse.accessToken};kmmAuthAPICall("/authUserByFacebook",function(apiData){kmmAuthLoadingButton($(buttonElement));if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);kmmAlert("success",apiData.data.user.nickname,kmmAuthGetAPIStatusMessage(apiData));kmmAuthBoxReset();$("#kmm-auth-box").modal("hide")},apiPayload)},apiPayload)},{scope:"email"})}function kmmAuthLogoutUser(){var apiPayload={session_id:KRN.user.session_id};kmmAuthAPICall("/logoutUser",function(apiData){var type="error";var title="Ooopps!";if(kmmAuthGetAPIStatusCode(apiData)){kmmAuthSetKRNUser(apiData);type="success";title="Erfolg"}kmmAlert(type,title,kmmAuthGetAPIStatusMessage(apiData))},apiPayload)}function kmmAuthUserSettings(){kmmUserSettingsActions("user-settings","#kmm-auth-box .modal-body .c_user-settings-form > form",true)}function kmmUserSettingsActions(btn,form,useModal){if(useModal){$("#kmm-auth-box").modal("hide")}swal({type:"input",title:"Profil bearbeiten",text:"Bitte geben Sie nochmals Ihr Passwort ein!",inputType:"password",cancelButtonText:"Abbrechen",confirmButtonText:"Absenden",showCancelButton:true},function(pw){if(!pw){return false}var secPayload={nickname:KRN.user.nickname,password:pw,tokenize:true};kmmAuthAPICall("/authUser",function(secData){if(!kmmAuthGetAPIStatusCode(secData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(secData));return false}var apiPayload={session_id:secData.data.session.id,token:secData.extended_data.token};kmmAuthSetKRNUser(secData);var loadRenderVerifyFormName=$(form);if(useModal){loadRenderVerifyFormName="user-settings";kmmAuthBoxReset();$("#kmm-auth-box .user-settings").removeClass("hidden");$("#kmm-auth-box .kmmauthbox__settingsbtn.us").addClass("kmmauthbox__settingsbtn--active");$("#kmm-auth-box .user-settings .kmmauthbox__column.us").removeClass("hidden");if(typeof KRN.user.facebook_status!=="undefined"&&KRN.user.facebook_status!=="C"){$("#kmm-auth-box .user-settings .kmmauthbox__settingsbtn").each(function(idx,element){if($(element).hasClass("dfb")){$(element).addClass("hidden")}else{$(element).css("width","49.5%")}})}else{$("#kmm-auth-box .user-settings .kmmauthbox__settingsbtn").each(function(idx,element){if($(element).hasClass("dfb")){$(element).removeClass("hidden")}else{$(element).css("width","")}})}}kmmAuthLoadForm("user-settings",function(userForm){if(userForm.error){kmmAlert("error","Ooopps!","Interner Systemfehler");return false}if(useModal){$("#kmm-auth-box").modal("show")}kmmAuthRenderForm(loadRenderVerifyFormName,userForm);$(form).find("#form_password_current").closest(".form-group").before('<div class="kmmauthbox__title">Passwort ändern</div>');$(form).on("submit",function(){kmmAuthLoadingButton(btn);cleanFormData=$(this).serialize();normalizedFormData=kmmNormalizeLoginData($(this).serializeArray());normalizedFormData.token=secData.extended_data.token;normalizedFormData.session_id=secData.data.session.id;normalizedFormData.save=true;kmmAuthVerifyForm("user-settings",function(formData){if(formData.error){kmmAlert("error","Ooopps!","Interner Systemfehler");kmmAuthLoadingButton(btn);return false}if($.isEmptyObject(formData)){kmmAlert("error","Ooopps!","Es wurden keine Änderungen gespeichert, da sich nichts geändert hat.");kmmAuthLoadingButton(btn);return false}var apiPayload=formData;apiPayload.session_id=normalizedFormData.session_id;apiPayload.token=normalizedFormData.token;kmmAuthAPICall("/setUserData",function(apiData){kmmAuthLoadingButton(btn);var type="error";var title="Ooopps!";if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert(type,title,kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);type="success";title="Erfolg";if($.inArray("mail_change_address",apiData.extended_data.updated)<0){kmmAlert(type,title,kmmAuthGetAPIStatusMessage(apiData))}else{swal({type:"success",title:"E-Mail bestätigen",text:"Sie erhalten in den nächsten Minuten ein Mail von krone.at mit dem Bestätigungslink. Sollten Sie nicht innerhalb von 24 Stunden auf den Bestätigungslink klicken, so wird der Registrierungsvorgang abgebrochen, Ihre Registrierungsdaten gelöscht und Ihr Benutzername wird zur erneuten Verwendung freigegeben. Bitte vergewissern Sie sich, dass die E-Mail mit dem Bestätigungslink nicht in Ihrem Spam-Ordner gelandet ist.",confirmButtonText:"Weiter zu krone.at",confirmButtonColor:"#e2001a",customClass:"kmmAlert",allowEscapeKey:false,allowEnterKey:false})}if(useModal){$("#kmm-auth-box").modal("hide")}},apiPayload)},normalizedFormData);return false})},apiPayload,!useModal?$(form):false)},secPayload)})}function kmmAuthPasswordForget(){kmmAuthLoadForm("pw-reset",function(formHtml){kmmAuthRenderForm("pw-reset",formHtml);kmmPasswordForgetActions("pw-reset","#kmm-auth-box .modal-body .c_pw-reset-form > form",true)});kmmAuthBoxReset();$("#kmm-auth-box .pw-reset").removeClass("hidden")}function kmmPasswordForgetActions(btn,form,useModal){$(form).on("submit",function(){kmmAuthLoadingButton(btn);cleanFormData=$(this).serialize();normalizedFormData=kmmNormalizeLoginData($(this).serializeArray());kmmAuthVerifyForm("pw-reset",function(formData){kmmAuthAPICall("/requestPasswordReset",function(apiData){kmmAuthLoadingButton(btn);if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);swal({type:"success",title:"Bestätigungslink zugesendet",text:"Der Bestätigungslink wurde an die von Ihnen angegebene E-Mail Adresse gesendet. Bitte vergewissern Sie sich, dass die E-Mail mit dem Bestätigungslink nicht in Ihrem Spam-Ordner gelandet ist.",confirmButtonText:"Weiter zu krone.at",confirmButtonColor:"#e2001a",customClass:"kmmAlert",allowEscapeKey:false,allowEnterKey:false});$(form)[0].reset();if(useModal){kmmAuthBoxReset();$("#kmm-auth-box").modal("hide")}},normalizedFormData)},cleanFormData);return false})}function kmmAuthDisconnectFB(buttonElement,force){if(typeof force==="undefined"||!force){kmmAuthBoxReset();$("#kmm-auth-box .user-settings").removeClass("hidden");$("#kmm-auth-box .kmmauthbox__settingsbtn.dfb").addClass("kmmauthbox__settingsbtn--active");$("#kmm-auth-box .user-settings .kmmauthbox__column.dfb").removeClass("hidden");$("#kmm-auth-form .dfb").removeClass("hidden");return false}kmmAuthLoadingButton($(buttonElement));var apiPayload={session_id:KRN.user.session_id};kmmAuthAPICall("/fbDisconnectUser",function(apiData){kmmAuthLoadingButton($(buttonElement));if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);swal({type:"success",title:"Verknüpfung getrennt",text:"Ihr krone.at Konto ist nun nicht mehr mit Ihrem Facebook-Profil verknüpft.",confirmButtonText:"Weiter zu krone.at",confirmButtonColor:"#e2001a",customClass:"kmmAlert"});kmmAuthBoxReset();$("#kmm-auth-box").modal("hide");if($("#kmm-auth-form").length>0){window.location.href="/"}},apiPayload)}function kmmAuthRequestUserDelete(buttonElement,force){if(typeof force==="undefined"||!force){kmmAuthBoxReset();$("#kmm-auth-box .user-settings").removeClass("hidden");$("#kmm-auth-box .kmmauthbox__settingsbtn.rud").addClass("kmmauthbox__settingsbtn--active");$("#kmm-auth-box .user-settings .kmmauthbox__column.rud").removeClass("hidden");$("#kmm-auth-form .rud").removeClass("hidden");return false}kmmAuthLoadingButton($(buttonElement));var apiPayload={session_id:KRN.user.session_id};kmmAuthAPICall("/requestDeleteUser",function(apiData){kmmAuthLoadingButton($(buttonElement));if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);swal({type:"success",title:"Halt!",text:kmmAuthGetAPIStatusMessage(apiData),cancelButtonText:"Abbrechen",confirmButtonText:"Jawohl",showCancelButton:true},function(isConfirm){if(!isConfirm){return false}var apiPayload={session_id:KRN.user.session_id,delete_key:apiData.extended_data.delete_key};kmmAuthAPICall("/forceDeleteUser",function(apiData){if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);swal({type:"success",title:"Benutzer gelöscht",text:"Ihr Benutzer wurde erfolgreich gelöscht.",confirmButtonText:"Weiter zu krone.at",confirmButtonColor:"#e2001a",customClass:"kmmAlert"});kmmAuthBoxReset();$("#kmm-auth-box").modal("hide");if($("#kmm-auth-form").length>0){window.location.href="/"}},apiPayload)})},apiPayload)}function kmmAuthGetActiveUser(){if(typeof Cookies.get("KMREGSESSID")==="undefined"||Cookies.get("KMREGSESSID")==="deleted"){return false}var apiPayload={session_id:Cookies.get("KMREGSESSID")};kmmAuthAPICall("/updateSession",function(apiData){if(!kmmAuthGetAPIStatusCode(apiData)){return false}kmmAuthSetKRNUser(apiData);kmmAuthRenderUserInfo()},apiPayload)}function kmmAuthLinkAction(){if(!kmmGetParameterByName("hash_id")){return false}$("#kmm-auth-box").data("hash_id",kmmGetParameterByName("hash_id"));var apiPayload={hash_id:kmmGetParameterByName("hash_id")};kmmAuthAPICall("/linkAction",function(apiData){if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);switch(apiData.extended_data.link_action){case"MAIL_VERIFY_CREATE":swal({type:"success",title:"Persönliche Daten ergänzen",text:"Ihr Benutzer wurde erfolgreich aktiviert! Möchten Sie mit aktuellen Informationen die auf Sie zugeschnitten sind versorgt werden, können Sie folgende Daten ergänzen.",cancelButtonText:"Persönliche Daten ergänzen",confirmButtonText:"Weiter zu krone.at",confirmButtonColor:"#e2001a",customClass:"kmmAlert",closeOnConfirm:true,closeOnCancel:true,showCancelButton:true},function(isConfirm){if(isConfirm){return false}setTimeout(function(){kmmAuthUserSettings()},500);return false});break;case"PASSWORD_RESET":if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthBoxReset();$("#kmm-auth-box .pw-set").removeClass("hidden");kmmAuthLoadForm("pw-set",function(formHtml){kmmAuthRenderForm("pw-set",formHtml);$("#kmm-auth-box").modal("show");$("#kmm-auth-box .modal-body .c_pw-set-form > form").on("submit",function(){kmmAuthLoadingButton("pw-set");cleanFormData=$(this).serialize();normalizedFormData=kmmNormalizeLoginData($(this).serializeArray());kmmAuthVerifyForm("pw-set",function(formData){normalizedFormData.hash_id=$("#kmm-auth-box").data("hash_id");kmmAuthAPICall("/setPassword",function(apiData){kmmAuthLoadingButton("pw-set");if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);swal({type:"success",title:"Neues Passwort gesetzt",text:"Ihr Passwort wurde erfolgreich geändert.",confirmButtonText:"Weiter zu krone.at",confirmButtonColor:"#e2001a",customClass:"kmmAlert"});kmmAuthBoxReset();$("#kmm-auth-box").modal("hide")},normalizedFormData)},cleanFormData);return false})},apiData.data.user);break;case"MAIL_VERIFY_UPDATE":swal({type:"success",title:"E-Mail Adresse geändert",text:"Die mit Ihrem krone.at Konto verknüpfte E-Mail Adresse wurde erfolgreich geändert.",confirmButtonText:"Weiter zu krone.at",confirmButtonColor:"#e2001a",customClass:"kmmAlert"});break;default:break}$("#kmm-auth-box").modal("hide")},apiPayload);history.replaceState("","",window.location.origin+window.location.pathname)}function kmmForumRegist(){kmmRegistActions($(".kmmauthbox__registbtn"),"form[name=registration]",false)}function kmmForumPasswordForget(){kmmPasswordForgetActions($(".kmmauthbox__pwresetbtn"),"form[name=password_forget]",false)}function kmmForumUserSettings(){if(typeof Cookies.get("KMREGSESSID")==="undefined"||Cookies.get("KMREGSESSID")==="deleted"){return false}kmmUserSettingsActions($(".kmmauthbox__savebtn"),"form[name=form]",false);return;var apiPayload={session_id:Cookies.get("KMREGSESSID")};kmmAuthAPICall("/getUserData",function(apiData){if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert("error","Ooopps!",kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);$("form[name=form]").data("user",JSON.stringify(apiData.data.user));kmmAuthLoadForm("user-settings",function(formHtml){kmmAuthRenderForm($("form[name=form]"),formHtml);$("form[name=form]").find("#form_password_current").closest(".form-group").before('<div class="kmmauthbox__title">Passwort ändern</div>');$("form[name=form]").on("submit",function(){kmmAuthLoadingButton($(".kmmauthbox__savebtn"));cleanFormData=$(this).serialize();normalizedFormData=kmmNormalizeLoginData($(this).serializeArray());kmmAuthVerifyForm("user-settings",function(formData){var apiPayload={};var oldState=JSON.parse($("form[name=form]").data("user"));$.each(normalizedFormData,function(key,value){console.log("check",key,"with",value);if(typeof oldState[key]==="undefined"&&value===null){console.log(key,"in oldState nicht vorhanden und sowieso leer");return true}else if(typeof oldState[key]==="undefined"&&value!==null){console.log(key,"in oldState nicht vorhanden aber nicht leer. wird hinzugefügt");apiPayload[key]=value}else if(oldState[key]===""&&value===null){console.log(key,"wurde nicht geändert");return true}else if(oldState[key]!==""&&value===null){console.log(key,"wurde ueberschrieben:",value);apiPayload[key]=""}else if(oldState[key]===""&&value!==null){console.log(key,"wurde gesetzt:",value);apiPayload[key]=value}else if(oldState[key]!==""&&value!==null){if(oldState[key]==value){console.log(key,"wurde ist gleich geblieben");return true}console.log(key,"wurde ueberschrieben:",value);apiPayload[key]=value}});if($.isEmptyObject(apiPayload)){kmmAuthLoadingButton($(".kmmauthbox__savebtn"));return false}bdKeys=["birthday_day","birthday_month","birthday_year"];$.each(apiPayload,function(k,v){if(k.indexOf("birthday")==0){bdKeys.splice(bdKeys.indexOf(k),1)}});console.log(apiPayload);console.log(oldState);if(bdKeys.length){$.each(bdKeys,function(i,v){apiPayload[v]=oldState[v]})}apiPayload.session_id=KRN.user.session_id;kmmAuthAPICall("/setUserData",function(apiData){kmmAuthLoadingButton($(".kmmauthbox__savebtn"));var type="error";var title="Ooopps!";if(!kmmAuthGetAPIStatusCode(apiData)){kmmAlert(type,title,kmmAuthGetAPIStatusMessage(apiData));return false}kmmAuthSetKRNUser(apiData);type="success";title="Erfolg";if($.inArray("mail_change_address",apiData.extended_data.updated)<0){kmmAlert(type,title,kmmAuthGetAPIStatusMessage(apiData))}else{swal({type:"success",title:"E-Mail bestätigen",text:"Sie erhalten in den nächsten Minuten ein Mail von krone.at mit dem Bestätigungslink. Sollten Sie nicht innerhalb von 24 Stunden auf den Bestätigungslink klicken, so wird der Registrierungsvorgang abgebrochen, Ihre Registrierungsdaten gelöscht und Ihr Benutzername wird zur erneuten Verwendung freigegeben. Bitte vergewissern Sie sich, dass die E-Mail mit dem Bestätigungslink nicht in Ihrem Spam-Ordner gelandet ist.",confirmButtonText:"Weiter zu krone.at",confirmButtonColor:"#e2001a",customClass:"kmmAlert",allowEscapeKey:false,allowEnterKey:false})}},apiPayload)},$(this).serialize());return false})},apiData.data.user)},apiPayload)}$(document).ready(function(){kmmAuthGetActiveUser();kmmAuthLinkAction()});
function krnPrivacyInit(){var cookie_params={domain:".krone.at",path:"/",expires:365};$(".krn_consent_toggle").each(function(){if(krnHasConsens($(this).attr("id"))){$(this).prop("checked",true)}});$(".krn_consent_toggle").on("click",function(){var state=$(this).prop("checked");var val=state?1:0;var cookie_name=$(this).attr("id");if(val===0){Cookies.remove(cookie_name,cookie_params)}else{Cookies.set(cookie_name,"1",cookie_params)}});$("#krn_consent_save").on("click",function(){Cookies.remove("krn_consent_mobile_scroll");var hash_id=krnGetAuthHash();if(hash_id){window.location.search+="&hash_id="+hash_id}else{window.location.reload()}});$("#krn_select_all").on("click",function(){var needsScroll=$(".krn-pc__body").outerHeight(true)<$(".krn-pc__body .row").outerHeight(true);if($("#krn-privacy-center .modal-body").css("max-height")!="none"){var scrollRange=$("#krn-privacy-center .modal-body .row").outerHeight(true)-$("#krn-privacy-center .modal-body").outerHeight(true)-10;needsScroll=$("#krn-privacy-center .modal-body").scrollTop()>scrollRange||needsScroll}if(!needsScroll||Cookies.get("krn_consent_mobile_scroll")){Cookies.remove("krn_consent_mobile_scroll");$(".krn_consent_toggle").each(function(){$(this).prop("checked",true);var cookie_name=$(this).attr("id");Cookies.set(cookie_name,"1",cookie_params)});Cookies.set("krn_consent_shown","1",cookie_params);$("#krn_consent_save").trigger("click")}else{Cookies.set("krn_consent_mobile_scroll","1");$(".krn-pc__body").animate({scrollTop:$(".krn-pc__body .row").outerHeight(true)},1e3,function(){$(".krn-pc__btn--accept").html("Akzeptieren & Schliessen")})}});$("#krn_consent_dismiss").on("click",function(){$(".krn_consent_toggle").each(function(){$(this).prop("checked",false);var cookie_name=$(this).attr("id");Cookies.remove(cookie_name,cookie_params)});Cookies.remove("krn_consent_shown",cookie_params);$("#krn_consent_save").trigger("click")});if(!window.location.pathname.match(/^\/1704878$/)&&!window.location.pathname.match(/^\/1711792$/)&&!Cookies.get("krn_consent_shown")&&!window.location.pathname.match(/app__/)){krnOpenPrivacyPopup()}}function krnOpenPrivacyPopup(){if(Cookies.get("krn_consent_shown")){$(".krn-pc").addClass("show-dismiss")}$("#krn-privacy-center").modal({backdrop:"static",keyboard:false}).on("shown.bs.modal",function(){var needsScroll=$(window).height()<$(".krn-pc").outerHeight(true);if(needsScroll){var maxHeight=$(window).height()-$("#krn-privacy-center .modal-header").outerHeight(true)-$("#krn-privacy-center .modal-footer").outerHeight(true)-parseInt($("#krn-privacy-center .krn-pc").css("margin-top"))-parseInt($("#krn-privacy-center .krn-pc").css("margin-bottom"));$("#krn-privacy-center .modal-body").css("max-height",maxHeight);$(".krn-pc__btn--accept").html("Weiter");$("#krn-privacy-center .modal-body")[0].addEventListener("scroll",function(){if($(".krn-pc__btn--accept").html()!="Weiter"){return false}var scrollRange=$("#krn-privacy-center .modal-body .row").outerHeight(true)-$("#krn-privacy-center .modal-body").outerHeight(true)-10;if($("#krn-privacy-center .modal-body").scrollTop()<scrollRange){return false}$(".krn-pc__btn--accept").html("Akzeptieren & Schliessen");Cookies.set("krn_consent_mobile_scroll","1")},{passive:true})}})}function krnLoadConsensBoxNote(div){if(!window.krnConsensNoteCache){$.get("/gdpr/box_consent_note?a",function(d){window.krnConsensNoteCache=d;$(div).html(window.krnConsensNoteCache)})}else{$(div).html(window.krnConsensNoteCache)}}function krnGetAuthHash(){var hash_id=$("#kmm-auth-box").data("hash_id");if(hash_id!==undefined){return hash_id}return false}$(document).ready(function(){krnPrivacyInit()});
kmmBitmovin={vars:{trackingActive:true,trackCMD:"kmm.send",trackParent:"Bitmovin Player",unMute:{text:"TON EINSCHALTEN",timeoutCompact:8e3},errorMsg:{3006:"Dieses Video kann in Ihrem Land nicht aufgerufen werden!"}},registerInView:function(playerObj){if(!playerObj.vars.inView){return false}var bmPlayer=playerObj.player;function resizeScrollEvent(){var inViewDisabled=playerObj.vars.inViewDisabled;var videoFinished=playerObj.vars.playbackFinished;var adFinished=playerObj.vars.adFinished;if(inViewDisabled){return false}if(typeof bmPlayer.ads!="undefined"){var initiatorStr="inview";if(!bmPlayer.ads.isLinearAdActive()&&!videoFinished){if(!videoFinished&&$(bmPlayer.getContainer()).isInViewport()){if(bmPlayer.isPaused()){bmPlayer.krnPlay()}}else{if(bmPlayer.isPlaying()){bmPlayer.krnPause(initiatorStr)}}}}else{if(bmPlayer.isPlaying()){bmPlayer.pause(initiatorStr)}}}$(document).on("resize",resizeScrollEvent);document.addEventListener("scroll",resizeScrollEvent,{passive:true})},initModules:function(){$(["engine-bitmovin","mserenderer","hls","abr","container-ts","polyfill","style","ui","dash","xml","advertising-core","advertising-ima","thumbnail"]).each(function(){bitmovin.player.core.Player.addModule(window.bitmovin.player[this].default)})},initAllPlayers:function(){if(typeof krnBitmovinPlayers=="undefined"){return true}$(krnBitmovinPlayers).each(function(){if(this.player!=null){return true}if(typeof bitmovin!="undefined"){var container=$("#"+this.playerDOMId)[0];this.player=new bitmovin.player.Player(container,this.config);var that=this;var player=this.player;$.each(kmmBitmovin.eventHandler,function(funcName,func){player.on(bitmovin.player.PlayerEvent[funcName],function(eventData){kmmBitmovin.eventHandler[funcName](that,eventData)})});var playerObj=this;playerObj.player.krnPlay=function(){var self=this;if(!self.krnInit){return}if(!self.krnPlayPending){r=self.play();if(Promise&&Promise.resolve&&Promise.resolve(r)==r){self.krnPlayPending=true;r.then(function(){self.krnPlayPending=false}).catch(function(e){})}}};playerObj.player.krnPause=function(initiatorStr){var self=this;if(!self.krnInit){return}if(!self.krnPausePending){r=self.pause(initiatorStr);if(Promise&&Promise.resolve&&Promise.resolve(r)==r){self.krnPausePending=true;r.then(function(){self.krnPausePending=false}).catch(function(e){})}}};this.player.load(this.config.source).then(function(player){kmmBitmovin.loadCustomUI(playerObj);if(playerObj.vars.inView){kmmBitmovin.registerInView(playerObj)}playerObj.vars.videoDuration=playerObj.player.getDuration();that.player.krnInit=true},function(reason){kmmBitmovin.log(reason)})}})},loadCustomUI:function(playerObj){var uiVariants=[];var recommendationsObj=[];if(typeof krn_recommended_posts!="undefined"){var recommendationsCntMobile=screen.width<350?1:2;var recommendationsCnt=kmmIsMobile()?recommendationsCntMobile:4;recommendationsObj=krn_recommended_posts.slice(0,recommendationsCnt)}var unMuteButton=new bitmovin.playerui.VolumeToggleButton({text:kmmBitmovin.vars.unMute.text,cssClass:"ui-volumetogglebutton btn-unmute"});uiVariants.push({ui:new bitmovin.playerui.UIContainer({components:[new bitmovin.playerui.RecommendationOverlay({hidden:false,recommendations:recommendationsObj,components:[]}),new bitmovin.playerui.ControlBar({components:[new bitmovin.playerui.Container({components:[new bitmovin.playerui.PlaybackToggleButton,new bitmovin.playerui.VolumeToggleButton,new bitmovin.playerui.VolumeSlider,new bitmovin.playerui.Spacer],cssClasses:["controlbar-bottom"]})]})],cssClasses:["ui-skin-modern kmm-bmpui-pause"]}),condition:function(context){return playerObj.player.isPaused()}});uiVariants.push({ui:new bitmovin.playerui.UIContainer({components:[unMuteButton],cssClasses:["ui-skin-modern kmm-bmpui-unmute"]}),condition:function(context){return playerObj.player.getConfig().playback.autoplay}});playerObj.uiManager=new bitmovin.playerui.UIManager(playerObj.player,uiVariants);$(playerObj.uiManager.player.getContainer()).find(".kmm-bmpui-unmute button").on("click",function(){kmmBitmovin.removeUnMuteButton(playerObj.uiManager.player)})},pauseAll:function(){$(krnBitmovinPlayers).each(function(){this.player.pause()})},eventHandler:{Play:function(playerObj,eventData){var playerVars=playerObj.vars;if(playerVars.playbackFinished&&!playerObj.player.ads.isLinearAdActive()){playerVars.playbackFinished=true}if(playerVars.playUnique==false){eventData.type="playUnique";kmmBitmovin.trackGA(playerObj,eventData);playerVars.playUnique=true}$(document).ready(function(){if(kmmIsMobile()){$("#"+playerObj.playerDOMId+" .bmpui-ui-titlebar").removeClass("bmpui-hidden")}});if(playerObj.player.ads.list().length==0){kmmBitmovin.setMuteButtonCompactTimer(playerObj)}playerVars.inViewDisabled=false},PlaybackFinished:function(playerObj,eventData){playerObj.vars.playbackFinished=true},Paused:function(playerObj,eventData){if(eventData.issuer!="inview"){playerObj.vars.inViewDisabled=true}},Error:function(playerObj,eventData){kmmBitmovin.trackGA(playerObj,eventData)},Seeked:function(playerObj,eventData){playerObj.vars.playbackRatesEnabled=false},VolumeChange:function(playerObj){kmmBitmovin.removeUnMuteButton(playerObj.player)},Unmuted:function(playerObj,eventData){kmmBitmovin.removeUnMuteButton(playerObj.player)},TimeChanged:function(playerObj,eventData){if(playerObj.vars.playbackRatesEnabled){var percentagePlayed=Math.ceil(eventData.time/playerObj.vars.videoDuration*100);switch(percentagePlayed){case 25:case 50:case 75:case 100:if(typeof playerObj.vars.playbackRates[percentagePlayed]=="undefined"){eventData.type="playPercentage-"+percentagePlayed;kmmBitmovin.trackGA(playerObj,eventData);playerObj.vars.playbackRates[percentagePlayed]=true}break}}},AdFinished:function(playerObj,eventData){playerObj.vars.adFinished=true;kmmBitmovin.setMuteButtonCompactTimer(playerObj)},AdStarted:function(playerObj,eventData){kmmBitmovin.trackGA(playerObj,eventData)},SubtitleAdded:function(playerObj,eventData){playerObj.player.subtitles.remove("CC1")}},removeUnMuteButton:function(player){$(player.getContainer()).find(".kmm-bmpui-unmute").remove()},setMuteButtonCompactTimer:function(playerObj){if(!playerObj.vars.adFinished&&!playerObj.player.ads.isLinearAdActive()){setTimeout(function(){$(playerObj.player.getContainer()).find(".kmm-bmpui-unmute").addClass("compact")},kmmBitmovin.vars.unMute.timeoutCompact)}},trackGA:function(playerObj,eventData){if(!kmmBitmovin.vars.trackingActive){return false}var trackCMD=kmmBitmovin.vars.trackCMD;var trackParent=kmmBitmovin.vars.trackParent;var trackArticleID=$('meta[name="krn-article-id"]').attr("content");var trackSlug=$('meta[name="krn-ressort-slug_hierarchical"]').attr("content");var mediaID=playerObj.vars.mediaID;var videoTitle=playerObj.vars.videoTitle;var videoCopyright=playerObj.vars.videoCopyright;var trackString=eventData.type+": /a/"+trackSlug+"/"+trackArticleID+"/"+mediaID+"/"+videoTitle+"/"+videoCopyright;if(typeof ga!="undefined"){ga(trackCMD,"event",trackString,trackParent)}},log:function(content){console.group("Bitmovin");console.log(content);console.groupEnd()}};
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n():"function"==typeof define&&define.amd?define(n):n()}(0,function(){"use strict";function e(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}function n(e){return!(!e||"undefined"==typeof e.length)}function t(){}function o(e){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=undefined,this._deferreds=[],c(e,this)}function r(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,o._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var o;try{o=t(e._value)}catch(r){return void f(n.promise,r)}i(n.promise,o)}else(1===e._state?i:f)(n.promise,e._value)})):e._deferreds.push(n)}function i(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if(n instanceof o)return e._state=3,e._value=n,void u(e);if("function"==typeof t)return void c(function(e,n){return function(){e.apply(n,arguments)}}(t,n),e)}e._state=1,e._value=n,u(e)}catch(r){f(e,r)}}function f(e,n){e._state=2,e._value=n,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;t>n;n++)r(e,e._deferreds[n]);e._deferreds=null}function c(e,n){var t=!1;try{e(function(e){t||(t=!0,i(n,e))},function(e){t||(t=!0,f(n,e))})}catch(o){if(t)return;t=!0,f(n,o)}}var a=setTimeout;o.prototype["catch"]=function(e){return this.then(null,e)},o.prototype.then=function(e,n){var o=new this.constructor(t);return r(this,new function(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}(e,n,o)),o},o.prototype["finally"]=e,o.all=function(e){return new o(function(t,o){function r(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var u=n.then;if("function"==typeof u)return void u.call(n,function(n){r(e,n)},o)}i[e]=n,0==--f&&t(i)}catch(c){o(c)}}if(!n(e))return o(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);for(var f=i.length,u=0;i.length>u;u++)r(u,i[u])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(n){n(e)})},o.reject=function(e){return new o(function(n,t){t(e)})},o.race=function(e){return new o(function(t,r){if(!n(e))return r(new TypeError("Promise.race accepts an array"));for(var i=0,f=e.length;f>i;i++)o.resolve(e[i]).then(t,r)})},o._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){a(e,0)},o._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();"Promise"in l?l.Promise.prototype["finally"]||(l.Promise.prototype["finally"]=e):l.Promise=o});
"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(n[c]=o[c])}return n},writable:!0,configurable:!0});